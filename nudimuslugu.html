<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nudim uslugu — Dogovoreno.com</title>
  <meta name="description" content="Kreiraj svoj profil majstora ili izvođača i primi upite od klijenata.">
  <link rel="stylesheet" href="base.css">
  <style>
    main{display:grid;gap:18px;padding:16px 16px 24px;max-width:820px;margin:0 auto}
    .card{background:var(--glass);border:1px solid var(--fieldBorder);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card h2{margin:0;padding:16px 16px 0;font-size:1.1rem}
    .card .sub{margin:6px 16px 0;color:var(--muted);font-size:.92rem}
    form{padding:14px 16px 16px;display:grid;gap:14px}
    label{display:block;font-size:.92rem;margin-bottom:6px;color:#e9edf6}
    .help{color:var(--muted);font-size:.86rem}
    .row{display:grid;gap:10px}
    input[type="text"],input[type="tel"],input[type="time"],textarea,select{
      width:100%;border-radius:12px;border:1px solid var(--fieldBorder);background:var(--field);
      color:var(--ink);padding:14px 12px;font-size:16px;outline:none;
    }
    textarea{min-height:120px;resize:vertical}
    .inline{display:grid;grid-template-columns:1fr auto;gap:10px}
    .actions{display:grid;gap:10px;margin-top:6px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 14px;border-radius:12px;border:0;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
    .btn-primary{background:var(--cta);color:#fff}
    .btn-ghost{background:rgba(255,255,255,.06);color:#fff;border:1px solid var(--fieldBorder)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:.78rem;background:rgba(255,255,255,.06);border:1px solid var(--fieldBorder);color:var(--muted)}
    .preview{padding:14px 16px 16px}
    .preview pre{white-space:pre-wrap;background:var(--field);border:1px solid var(--fieldBorder);padding:12px;border-radius:12px;line-height:1.45}

    /* Modal (vještine + prijava zanimanja) */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:100}
    .modal[open]{display:flex}
    .modal-card{width:min(92vw, 780px);max-height:80vh;overflow:hidden;background:var(--bg);border:1px solid var(--fieldBorder);border-radius:16px;box-shadow:var(--shadow);display:grid;grid-template-rows:auto auto 1fr}
    .modal-head{display:flex;align-items:center;gap:10px;padding:12px 12px 8px;border-bottom:1px solid var(--fieldBorder)}
    .modal-head input{flex:1;border-radius:10px;border:1px solid var(--fieldBorder);background:var(--field);color:var(--ink);padding:10px 12px;font-size:16px}
    .modal-body{overflow:auto;padding:10px 8px}
    .list{display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:6px}
    .item{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--fieldBorder);border-radius:10px;background:rgba(255,255,255,.04);cursor:pointer}
    .item:hover{background:rgba(255,255,255,.08)}
    @media (max-width:640px){ .list{grid-template-columns:1fr} }

    .quiet{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .muted{color:var(--muted)}

    /* Tagovi odabranih vještina */
    #skillsTags{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.06);border:1px solid var(--fieldBorder);font-size:.86rem}
    .tag button{all:unset;cursor:pointer;opacity:.8}

    /* Friendly reminder box */
    .reminder{display:grid;gap:8px;padding:12px;border:1px dashed var(--fieldBorder);border-radius:12px;background:rgba(255,255,255,.04)}
    .reminder strong{font-size:.96rem}
  </style>
</head>
<body>

  <!-- zajednički header -->
  <div data-include="header.html"></div>

  <main>
    <section class="card">
      <h2>Kreiraj svoj profil</h2>
      <p class="sub">
        Za majstore i sve koji nude uslugu. <span class="badge">Lokacija nije javna — prikazuje se tek nakon dogovora</span>
      </p>

      <form id="provForm" novalidate>
        <!-- Vještine (više odabira) -->
        <div class="row">
          <label>Koje vještine najbolje opisuju vaš rad? *</label>
          <div class="inline">
            <input type="text" id="skillsInput" placeholder="Odaberi vještine" readonly required>
            <button type="button" class="btn btn-ghost" id="openOcc">Odaberi</button>
          </div>
          <div id="skillsTags"></div>

          <!-- FRIENDLY REMINDER -->
          <div class="reminder">
            <strong>Ne vidite svoje zanimanje na popisu?</strong>
            <div class="help">
              Pošaljite nam prijedlog i učinit ćemo sve da ga što prije dodamo kako biste se mogli registrirati.
            </div>
            <div>
              <button type="button" class="btn btn-primary" id="openSuggest">Predloži novo zanimanje</button>
            </div>
          </div>

          <div class="help">Možeš odabrati više vještina (npr. Knauf + Keramika + Vodoinstalater).</div>
        </div>

        <!-- Telefon -->
        <div class="row">
          <label for="phone">Broj telefona *</label>
          <input type="tel" id="phone" placeholder="+387 6X XXX XXX" required>
        </div>

        <!-- Lokacija (bez mape za sada) -->
        <div class="row">
          <label for="location">Lokacija (grad / naselje / ulica) *</label>
          <input type="text" id="location" placeholder="npr. Sarajevo, Grbavica" required>
          <div class="help">Točna lokacija neće biti javna — klijent je vidi tek nakon dogovora.</div>
        </div>

        <!-- Opis -->
        <div class="row">
          <label for="bio">Kratko o vama / obrtu *</label>
          <textarea id="bio" placeholder="Npr. 10+ godina iskustva, specijaliziran za... Radimo uredno i u dogovorenim rokovima." required></textarea>
        </div>

        <!-- Recenzije -->
        <div class="row">
          <label><input type="checkbox" id="reviews" checked> Želim da mi se ostavljaju recenzije</label>
          <div class="help">Recenzije pomažu da te brže izaberu. Neprimjerene recenzije se mogu prijaviti.</div>
        </div>

        <!-- Ne uznemiravaj -->
        <div class="row">
          <label>Vrijeme u koje ne želim primati upite</label>
          <div class="quiet">
            <div>
              <span class="muted">Od</span>
              <input type="time" id="quiet_from" value="18:00">
            </div>
            <div>
              <span class="muted">Do</span>
              <input type="time" id="quiet_to" value="07:00">
            </div>
          </div>
          <div class="help">Upiti pristigli u ovom terminu bit će odgođeni i isporučeni u prvom dopuštenom terminu.</div>
        </div>

        <div class="actions">
          <button type="button" id="btnPreview" class="btn btn-ghost">Pregled profila</button>
          <button type="submit" class="btn btn-primary">Spremi profil (MVP)</button>
        </div>
      </form>

      <!-- PREVIEW -->
      <div class="preview" id="previewBox" hidden>
        <h2 style="margin:0 0 8px 0;">Pregled profila</h2>
        <pre id="previewText"></pre>
      </div>
    </section>
  </main>

  <!-- zajedničke reklame + footer -->
  <div data-include="ads.html"></div>
  <div data-include="footer.html"></div>

  <!-- include loader -->
  <script src="include.js"></script>

  <!-- Modal: odabir vještina (multi-select) -->
  <dialog class="modal" id="occModal">
    <div class="modal-card" role="dialog" aria-labelledby="occTitle">
      <div class="modal-head">
        <strong id="occTitle" style="font-size:1rem">Odaberi vještine</strong>
        <input type="text" id="occSearch" placeholder="Traži… (npr. Keramika)">
        <button class="btn" id="occApply" type="button">Primijeni</button>
        <button class="btn" id="occClose" type="button">Zatvori</button>
      </div>
      <div class="modal-body">
        <div class="list" id="occList"></div>
      </div>
    </div>
  </dialog>

  <!-- Modal: prijedlog novog zanimanja -->
  <dialog class="modal" id="suggestModal">
    <div class="modal-card" role="dialog" aria-labelledby="sugTitle" style="grid-template-rows:auto 1fr auto">
      <div class="modal-head">
        <strong id="sugTitle" style="font-size:1rem">Predloži novo zanimanje</strong>
      </div>
      <div class="modal-body" style="padding:14px 16px;display:grid;gap:10px">
        <label for="sugName">Kako se zove zanimanje / usluga?</label>
        <input type="text" id="sugName" placeholder="npr. Majstor za peći na pelet" />
        <label for="sugNote">Kratka napomena (opcionalno)</label>
        <textarea id="sugNote" placeholder="Zašto bi trebalo biti na listi, što točno radite…"></textarea>
        <div class="help">Poruka ide administratoru (MVP: lokalno spremanje — kasnije backend/Sheet).</div>
      </div>
      <div class="modal-head" style="border-top:1px solid var(--fieldBorder);justify-content:flex-end">
        <button class="btn btn-ghost" id="sugCancel" type="button">Odustani</button>
        <button class="btn btn-primary" id="sugSend" type="button">Pošalji</button>
      </div>
    </div>
  </dialog>

  <script>
    // —————— Jednostavne, jasne kategorije vještina ——————
    const SKILLS = [
      "Arhitekt / Projektant",
      "Auto servis (mehanika/elektrika)",
      "Bravar / Zavarivač",
      "Čišćenje prostora",
      "Dizajner interijera",
      "Elektroinstalater / Električar",
      "Fasader / Žbukanje",
      "Fotograf",
      "Geodet",
      "Građevinski radovi (opći)",
      "Grafički dizajn",
      "Hidroizolacija",
      "Instalater grijanja / Klima / Plin",
      "Internet marketing (SEO/Ads)",
      "IT podrška (Helpdesk)",
      "Keramičar",
      "Knauf / Suha gradnja",
      "Krovopokrivač / Limar",
      "PVC/ALU stolarija (ugradnja)",
      "Moler (soboslikar)",
      "Monter namještaja / Kuhinja",
      "Odvoz otpada / čišćenje terena",
      "Parketar / Podopolagač",
      "Pelet / Kotlovi (servis)",
      "Prijevoz kombi (dostava/selidbe)",
      "Prijevoz kamion",
      "Servis bijele tehnike",
      "Servis klima uređaja",
      "Servis računala",
      "Servis telefona / elektronike",
      "Solarne elektrane – montaža",
      "Staklar",
      "Stolar (po mjeri)",
      "Tesar",
      "Alarmni sustavi / Video nadzor",
      "Uredske/pisarske usluge",
      "Uređenje okućnice / Vrtlar",
      "Vodoinstalater",
      "Vozač bagera / Iskopi",
      "Web dizajn / WordPress",
      "Završni radovi (generalni)"
    ].sort((a,b)=>a.localeCompare(b,'hr'));

    // —————— Multi-select vještine (modal + tagovi) ——————
    const selectedSkills = new Set();
    const occModal   = document.getElementById('occModal');
    const occList    = document.getElementById('occList');
    const occSearch  = document.getElementById('occSearch');
    const occApply   = document.getElementById('occApply');
    const skillsInput= document.getElementById('skillsInput');
    const skillsTags = document.getElementById('skillsTags');

    function renderOcc(items){
      occList.innerHTML = '';
      items.forEach(name=>{
        const id = 'skill_' + name.replace(/\W+/g,'_');
        const wrap = document.createElement('label');
        wrap.className = 'item';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.id = id;
        cb.checked = selectedSkills.has(name);
        cb.addEventListener('change', ()=>{
          if(cb.checked){
            // (opcionalno) limit npr. 6 vještina:
            // if(selectedSkills.size >= 6){ cb.checked=false; alert('Maksimalno 6 vještina.'); return; }
            selectedSkills.add(name);
          } else {
            selectedSkills.delete(name);
          }
        });
        const span = document.createElement('span');
        span.textContent = name;
        wrap.append(cb, span);
        occList.appendChild(wrap);
      });
    }

    function renderTags(){
      skillsTags.innerHTML = '';
      [...selectedSkills].forEach(name=>{
        const t = document.createElement('span');
        t.className = 'tag';
        t.innerHTML = `${name} <button title="Ukloni">✕</button>`;
        t.querySelector('button').addEventListener('click', ()=>{
          selectedSkills.delete(name);
          renderTags();
          if(occModal.open){
            const q = occSearch.value.trim().toLowerCase();
            const filtered = SKILLS.filter(x=>x.toLowerCase().includes(q));
            renderOcc(filtered);
          }
          updateSkillsInput();
        });
        skillsTags.appendChild(t);
      });
    }

    function updateSkillsInput(){
      const arr = [...selectedSkills];
      skillsInput.value = arr.length ? arr.join(', ') : '';
    }

    document.getElementById('openOcc').addEventListener('click', ()=>{
      occModal.showModal();
      occSearch.value = '';
      renderOcc(SKILLS);
      setTimeout(()=>occSearch.focus(), 50);
    });
    document.getElementById('occClose').addEventListener('click', ()=> occModal.close());
    occApply.addEventListener('click', ()=>{
      updateSkillsInput();
      renderTags();
      occModal.close();
    });
    occSearch.addEventListener('input', ()=>{
      const q = occSearch.value.trim().toLowerCase();
      const filtered = SKILLS.filter(x=>x.toLowerCase().includes(q));
      renderOcc(filtered);
    });

    // —————— Modal: Predloži novo zanimanje ——————
    const suggestModal = document.getElementById('suggestModal');
    const openSuggest  = document.getElementById('openSuggest');
    const sugName      = document.getElementById('sugName');
    const sugNote      = document.getElementById('sugNote');
    document.getElementById('sugCancel').addEventListener('click', ()=> suggestModal.close());
    document.getElementById('sugSend').addEventListener('click', ()=>{
      const name = (sugName.value||'').trim();
      const note = (sugNote.value||'').trim();
      if(!name){ alert('Upišite naziv zanimanja/usluge.'); sugName.focus(); return; }
      const entry = { id:'miss_'+Date.now(), name, note, ts:new Date().toISOString() };
      try{
        const box = JSON.parse(localStorage.getItem('dog_missing_skills')||'[]');
        box.push(entry);
        localStorage.setItem('dog_missing_skills', JSON.stringify(box));
      }catch(_){}
      // reset
      sugName.value = ''; sugNote.value = '';
      suggestModal.close();
      alert('Hvala! Primili smo prijedlog. Dodat ćemo ga što prije.'); // MVP
      // (kasnije: slanje u backend/Sheet umjesto LocalStorage)
    });
    openSuggest.addEventListener('click', ()=>{
      suggestModal.showModal();
      setTimeout(()=>sugName.focus(), 50);
    });

    // —————— Preview & Local save (MVP) ——————
    const form = document.getElementById('provForm');
    const box  = document.getElementById('previewBox');
    const pre  = document.getElementById('previewText');

    function buildProfile(){
      const data = {
        skills: [...selectedSkills],
        phone: document.getElementById('phone').value.trim(),
        location: document.getElementById('location').value.trim(),
        bio: document.getElementById('bio').value.trim(),
        reviews: document.getElementById('reviews').checked,
        quiet_from: document.getElementById('quiet_from').value,
        quiet_to: document.getElementById('quiet_to').value
      };
      return data;
    }

    function preview(){
      const d = buildProfile();
      let t = "🧰 *PROFIL IZVOĐAČA — Dogovoreno.com*\n";
      t += "———————————————\n";
      t += `🧰 Vještine: ${d.skills && d.skills.length ? d.skills.join(', ') : '—'}\n`;
      t += `📞 Telefon: ${d.phone || '—'}\n`;
      t += `📍 Lokacija: ${d.location || '—'} (točna lokacija nije javna)\n`;
      t += `📝 Opis: ${d.bio || '—'}\n`;
      t += `⭐ Recenzije: ${d.reviews ? 'Dozvoljene' : 'Onemogućene'}\n`;
      t += `⛔ Ne uznemiravaj: ${d.quiet_from || '—'} → ${d.quiet_to || '—'}\n`;
      pre.textContent = t;
      box.hidden = false;
    }

    document.getElementById('btnPreview').addEventListener('click', preview);

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const d = buildProfile();
      const errors = [];
      if(!d.skills || d.skills.length===0) errors.push('Odaberi barem jednu vještinu.');
      if(!d.phone) errors.push('Unesi telefon.');
      if(!d.location) errors.push('Unesi lokaciju.');
      if(!d.bio) errors.push('Unesi kratki opis.');
      if(errors.length){ alert('Nedostaje:\n• ' + errors.join('\n• ')); return; }

      // spremi lokalno kao MVP (kasnije JSON/Sheet/backend)
      try{
        const list = JSON.parse(localStorage.getItem('dog_providers')||'[]');
        list.push({...d, id:'prov_'+Date.now()});
        localStorage.setItem('dog_providers', JSON.stringify(list));
      }catch(_){}
      preview();
      alert('Profil spremljen lokalno (MVP). Za produkciju ćemo spremati u JSON/Sheet.');
    });
  </script>

</body>
</html>
