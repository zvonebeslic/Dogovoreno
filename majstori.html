<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pronaƒëi majstora ‚Äî Dogovoreno.com</title>
  <link rel="stylesheet" href="base.css">
  <style>
    :root{
      --bg:#0f1115; --ink:#0b1220; --muted:#c7cbd4;
      --cta:#2563eb; --accent:#16a34a;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.35);
      --fieldBorder:rgba(255,255,255,.12);
    }
    body{ background:#0f1115; color:#f7f8fa; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif }
    .page{ min-height:100svh; display:grid; grid-template-rows:auto 1fr auto; }
    .page-wrap{ max-width:980px; margin:18px auto 64px; padding:0 16px; }

    /* PANEL (tamni wrapper kao na nudim/tra≈æim) */
    .panel{
      background: linear-gradient(180deg, rgba(26,29,35,.96) 0%, rgba(22,25,31,.96) 100%);
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }

    /* Naslovi ‚Äî iste veliƒçine kao na drugim stranicama */
    .h1{ font-weight:600; font-size:clamp(18px,3vw,26px); margin:0 0 6px }
    .lead{ color:#c7cbd4; margin:0 0 10px } /* (dodano malo dna radi razmaka) */

    /* Cloud (svijetli ‚Äúoblaci‚Äù) */
    .cloud{
      background: linear-gradient(180deg, rgba(255,255,255,.78) 0%, rgba(246,247,249,.72) 100%);
      backdrop-filter: blur(4px);
      border:1px solid rgba(0,0,0,.06);
      border-radius:var(--radius);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 8px 22px rgba(0,0,0,.22);
      padding:16px; margin:12px 0; color:var(--ink);
    }
    .cloud h4{ margin:0 0 10px; font-size:18px; color:#0b1220 } /* manji podnaslov */
    .hint{ color:#334155; font-size:12px; margin-top:6px }
    .row{ display:grid; gap:10px }
    .row.two{ grid-template-columns:1fr 1fr }

    /* Chip ‚Äì bijeli s crnim tekstom */
    .chips{ display:flex; flex-wrap:wrap; gap:8px }
    .chip{
      display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
      border:1px solid rgba(0,0,0,.10); background:#ffffff; color:#0b1220; font-weight:600;
    }
    .chip button{ all:unset; cursor:pointer; opacity:.85 } .chip button:hover{ opacity:1 }

    /* Gumbi ‚Äî isti vizual */
    .btn{ appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer }
    .btn-primary{
      background:linear-gradient(180deg, #2b6ee9 0%, #245ed0 100%);
      color:#fff; border:1px solid rgba(0,0,0,.2);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 6px 16px rgba(37,99,235,.28);
      transition: transform .08s ease;
    }
    .btn-primary:active{ transform: translateY(1px); }
    .btn-accent{
      background: linear-gradient(180deg, #16a34a 0%, #0f8a3a 55%, #0b6f30 100%);
      color:#e6fff4; border:1px solid rgba(0,0,0,.35);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.14), 0 6px 16px rgba(16,163,74,.25);
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn-accent:hover{ filter:brightness(1.03); box-shadow: inset 0 1px 0 rgba(255,255,255,.18), 0 8px 20px rgba(16,163,74,.32); }
    .btn-accent:active{ transform: translateY(1px); box-shadow: inset 0 2px 4px rgba(0,0,0,.25), 0 3px 10px rgba(16,163,74,.22); }
    .btn-small{ padding:8px 10px; border-radius:10px }
    .btn-ghost{ background:transparent; color:#ffffff; border:2px solid #ffffff; }

    /* Rezultati */
    .card{ border:1px solid var(--fieldBorder); border-radius:12px; background:rgba(255,255,255,.06) }
    .card-pad{ padding:16px }
    .results{ display:grid; gap:12px }
    @media(min-width:720px){ .results{ grid-template-columns:1fr 1fr } }
    .prov-head{ display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap }
    .muted{ color:#c7cbd4 }
    .badge{ display:inline-flex; align-items:center; gap:6px; border:1px solid var(--fieldBorder); border-radius:999px; padding:4px 8px; font-size:12px; background:rgba(255,255,255,.06) }

    /* Toast ‚Äì naranƒçasti */
    .toast{
      position:fixed; left:50%; bottom:25px; transform:translateX(-50%);
      background:#f97316; color:#fff; padding:10px 14px; border-radius:12px; box-shadow:var(--shadow);
      display:none; z-index:9999;
    }
    .toast.show{ display:block }

    /* Dialogi ‚Äì teme isto kao na drugim stranicama */
    dialog{ border:0; border-radius:16px; background:#0e1014; color:#f7f8fa; width:min(720px, 96vw) }
    dialog::backdrop{ background:rgba(0,0,0,.4) }
    .dlg-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08) }
    .dlg-body{ padding:0; max-height:70vh; overflow:auto; overscroll-behavior:contain }
    .dlg-actions{ padding:14px 16px; display:flex; gap:10px; justify-content:center; border-top:1px solid rgba(255,255,255,.08) }
    .dlg-search{ position:sticky; top:0; z-index:2; background:#0e1014; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08) }

    /* Skill list u popupu (tamni, kao i drugdje) */
    #skillSearch{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#0b0d11; color:#fff }
    .list{ display:grid; gap:8px; padding:14px 16px; min-height:35vh }
    .item{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03) }

    /* DlgPlace ‚Äì SVIJETLI (kao na nudim/tra≈æim) */
    #dlgPlace{
      background: linear-gradient(180deg, rgba(255,255,255,.90) 0%, rgba(246,247,249,.86) 100%);
      color:#0b1220;
    }
    #dlgPlace .dlg-head{ border-bottom:1px solid rgba(0,0,0,.08) }
    #dlgPlace .dlg-actions{ border-top:1px solid rgba(0,0,0,.08) }
    #dlgPlace .field select, #dlgPlace .field input{
      background:#ffffff; color:#0b1220; border:1px solid rgba(0,0,0,.15);
      border-radius:12px; padding:10px 12px; outline:none; font-family:inherit; font-size:inherit;
    }
    #dlgPlace .field select:focus, #dlgPlace .field input:focus{
      outline:2px solid rgba(37,99,235,.25); border-color:rgba(37,99,235,.45);
    }

    /* DlgRadius ‚Äì TAKOƒêER SVIJETLI (ujednaƒçeno kao Podruƒçje) */
    #dlgRadius{
      background: linear-gradient(180deg, rgba(255,255,255,.90) 0%, rgba(246,247,249,.86) 100%);
      color:#0b1220;
    }
    #dlgRadius .dlg-head{ border-bottom:1px solid rgba(0,0,0,.08) }
    #dlgRadius .dlg-actions{ border-top:1px solid rgba(0,0,0,.08) }
    #dlgRadius .dlg-body{ padding:14px 16px }
    .radius-grid{ display:grid; gap:8px; grid-template-columns:repeat(3,1fr) }
    .radius-btn{
      appearance:none; border:1px solid rgba(0,0,0,.15); border-radius:10px; padding:10px 12px;
      background:#ffffff; color:#0b1220; cursor:pointer; text-align:center; font-weight:600;
    }
    .radius-btn[aria-current="true"]{ outline:2px solid #16a34a; outline-offset:0 }
  </style>
</head>
<body>
  <main class="page">
    <div data-include="header.html"></div>

    <div class="page-wrap">
      <div class="panel">
        <h1 class="h1">Pronaƒëi majstora</h1>
        <p class="lead">Pronaƒëi provjerene majstore po vje≈°tinama i lokaciji.</p> <!-- PODNASLOV (vratili) -->

        <!-- 1) VJE≈†TINA (max 3) -->
        <section class="cloud" aria-labelledby="lab-skill">
          <h4 id="lab-skill">Vje≈°tina</h4>
          <div class="row">
            <div id="skillChips" class="chips" aria-live="polite"></div>
            <div><button id="btnPickSkill" class="btn btn-accent btn-small" type="button">Odaberi vje≈°tinu</button></div>
          </div>
          <div class="hint">Mo≈æe≈° odabrati najvi≈°e <b>3 vje≈°tine</b>. Poƒçni s najva≈ænijom.</div> <!-- HINT ispod vje≈°tina -->
        </section>

        <!-- 2) PODRUƒåJE ILI RADIJUS (meƒëusobno iskljuƒçivo) -->
        <section class="cloud" aria-labelledby="lab-where">
          <h4 id="lab-where">Podruƒçje ili radijus</h4>

          <div class="row two">
            <!-- Podruƒçje -->
            <div>
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                <button id="btnPickPlace" class="btn btn-ghost btn-small" type="button">Odaberi podruƒçje</button>
                <div id="placeChip" class="chips" aria-live="polite"></div>
              </div>
            </div>

            <!-- Radijus -->
            <div>
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                <button id="btnPickRadius" class="btn btn-ghost btn-small" type="button">Odaberi radijus</button>
                <div id="radiusChip" class="chips" aria-live="polite"></div>
              </div>
            </div>
          </div>

          <div class="hint" style="margin-top:8px">* Mo≈æe biti odabrano samo <b>jedno</b>: ili podruƒçje <i>ili</i> radijus. Druga opcija se zakljuƒçava dok ne oƒçisti≈° chip.</div>
        </section>

        <!-- CTA -->
        <div style="display:flex; justify-content:flex-end; margin-top:12px">
          <button id="btnSearch" class="btn btn-primary">Potra≈æi majstora</button>
        </div>

        <!-- REZULTATI -->
        <section id="resultsWrap" style="margin-top:12px">
          <section id="results" class="results"></section>
        </section>
      </div>
    </div>

    <div data-include="footer.html"></div>
  </main>

  <!-- ====== DIALOGI ====== -->
  <!-- Vje≈°tine (max 3, Save/Cancel/‚úï) -->
  <dialog id="dlgSkills">
    <div class="dlg-head">
      <strong>Odaberi vje≈°tine (max 3)</strong>
      <button class="btn btn-ghost btn-small" id="skillX" type="button">‚úï</button>
    </div>
    <div class="dlg-body">
      <div class="dlg-search"><input id="skillSearch" placeholder="Pretra≈æi ruƒçno.."></div>
      <div id="skillList" class="list" role="listbox" aria-multiselectable="true"></div>
    </div>
    <div class="dlg-actions">
      <button class="btn btn-ghost" id="skillCancel" type="button">Odustani</button>
      <button class="btn btn-primary" id="skillSave" type="button">Spremi</button>
    </div>
  </dialog>

  <!-- Podruƒçje (svijetli) -->
  <dialog id="dlgPlace">
    <div class="dlg-head">
      <strong>Ruƒçni odabir mjesta</strong>
      <button class="btn btn-ghost btn-small" id="placeX" type="button">‚úï</button>
    </div>
    <div class="dlg-body" style="padding:14px 16px">
      <div class="row two">
        <div class="field"><label class="hint">Dr≈æava</label><select id="selCountry"></select></div>
        <div class="field"><label class="hint">Grad / mjesto</label><select id="selCity" disabled></select></div>
      </div>
    </div>
    <div class="dlg-actions">
      <button class="btn btn-ghost" id="placeCancel" type="button">Odustani</button>
      <button class="btn btn-primary" id="placeSave" type="button">Spremi</button>
    </div>
  </dialog>

  <!-- Radijus (svijetli, 10‚Üí100 km) -->
  <dialog id="dlgRadius">
    <div class="dlg-head">
      <strong>Odaberi radijus</strong>
      <button class="btn btn-ghost btn-small" id="radiusX" type="button">‚úï</button>
    </div>
    <div class="dlg-body">
      <div class="radius-grid" id="radiusList"></div>
    </div>
    <div class="dlg-actions">
      <button class="btn btn-ghost" id="radiusCancel" type="button">Odustani</button>
      <button class="btn btn-primary" id="radiusSave" type="button">Spremi</button>
    </div>
  </dialog>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="include.js"></script>
  <script>
    /* ===== UTIL ===== */
    const $ = s => document.querySelector(s);
    const toast = (m)=>{ const t=$('#toast'); t.textContent=m; t.classList.add('show'); clearTimeout(t._hide); t._hide=setTimeout(()=>t.classList.remove('show'),3000); };

    /* ===== API (isti endpointi) ===== */
    async function apiProviders(filters={}){
      const qs = new URLSearchParams();
      if (filters.skill) qs.set('skill', filters.skill);
      if (filters.skills && filters.skills.length) qs.set('skills', filters.skills.join(',')); // (opcija: vi≈°e vje≈°tina)
      if (filters.location) qs.set('location', filters.location);
      if (Number.isFinite(filters.qlat)) qs.set('qlat', filters.qlat);
      if (Number.isFinite(filters.qlng)) qs.set('qlng', filters.qlng);
      if (Number.isFinite(filters.radius_km)) qs.set('radius_km', filters.radius_km);
      const r = await fetch('api/auth.php?route=providers&'+qs.toString());
      const j = await r.json();
      if(!r.ok) throw new Error(j.error||'Gre≈°ka');
      return j.data || [];
    }

    /* ===== VJE≈†TINE (max 3, Save/Cancel/‚úï) ===== */
    const ALL_SKILLS=[];
    const dlgSkills = $('#dlgSkills');
    const skillSearch = $('#skillSearch');
    const skillList = $('#skillList');
    const skillChips = $('#skillChips');

    const selectedSkills = new Set();   // POTVRƒêENO
    let tempSkills = new Set();         // PRIVREMENO u popupu

    function renderSkillChips(){
      skillChips.innerHTML='';
      selectedSkills.forEach(s=>{
        const chip=document.createElement('span'); chip.className='chip';
        chip.innerHTML=`<span>${s}</span> <button title="Ukloni" aria-label="Ukloni">‚úï</button>`;
        chip.querySelector('button').addEventListener('click', ()=>{
          selectedSkills.delete(s);
          renderSkillChips();
        });
        skillChips.appendChild(chip);
      });
    }
    function renderSkillList(filter=''){
      skillList.innerHTML='';
      const f=(filter||'').toLowerCase().trim();
      ALL_SKILLS
        .filter(s=>!f || s.toLowerCase().includes(f))
        .forEach(s=>{
          const row=document.createElement('label'); row.className='item';
          row.innerHTML=`<span>${s}</span><input type="checkbox" ${tempSkills.has(s)?'checked':''}>`;
          const cb=row.querySelector('input');
          cb.addEventListener('change', ()=>{
            if(cb.checked){
              if(tempSkills.size>=3){ cb.checked=false; toast('Max 3 vje≈°tine.'); return; }
              tempSkills.add(s);
            } else {
              tempSkills.delete(s);
            }
          });
          skillList.appendChild(row);
        });
    }
    $('#btnPickSkill').addEventListener('click', ()=>{
      // snapshot
      tempSkills = new Set(selectedSkills);
      dlgSkills.showModal();
      skillSearch.value=''; renderSkillList();
      setTimeout(()=>skillSearch.focus(),50);
    });
    $('#skillSave').addEventListener('click', ()=>{
      selectedSkills.clear();
      tempSkills.forEach(s=> selectedSkills.add(s));
      renderSkillChips();
      dlgSkills.close();
    });
    function closeSkills(){ tempSkills = new Set(); dlgSkills.close(); }
    $('#skillCancel').addEventListener('click', closeSkills);
    $('#skillX').addEventListener('click', closeSkills);
    dlgSkills.addEventListener('cancel', (e)=>{ e.preventDefault(); closeSkills(); });
    skillSearch.addEventListener('input', ()=> renderSkillList(skillSearch.value));

    fetch('data/skills.json').then(r=>r.json()).then(list=>{
      const arr = Array.isArray(list) ? list : (Array.isArray(list.skills) ? list.skills : []);
      ALL_SKILLS.push(...arr.sort((a,b)=>a.localeCompare(b,'hr')));
      renderSkillList();
    }).catch(()=>{});

    /* ===== PODRUƒåJE vs RADIJUS (mutual exclusive) ===== */
    const dlgPlace=$('#dlgPlace'), selCountry=$('#selCountry'), selCity=$('#selCity');
    const placeChip=$('#placeChip');
    const btnPickPlace = $('#btnPickPlace');

    const COUNTRY_FILES={
      "BiH": "data/cities-bih.json",
      "Hrvatska": "data/cities-hr.json",
      "Srbija": "data/cities-rs.json",
      "Slovenija": "data/cities-si.json",
      "Crna Gora": "data/cities-me.json",
      "S. Makedonija": "data/cities-mk.json"
    };

    let chosenPlace = null;   // { country, city, lat, lng, label } (POTVRƒêENO)
    let tempPlace = null;     // PRIVREMENO u popupu
    let chosenRadius = null;  // POTVRƒêENO
    let tempRadius = null;    // PRIVREMENO

    function setLocks(){
      const hasArea = !!chosenPlace;
      const hasRadius = Number.isFinite(chosenRadius);
      btnPickPlace.disabled = hasRadius;
      $('#btnPickRadius').disabled = hasArea;
      $('#placeChip').style.opacity  = hasRadius ? .5 : 1;
      $('#radiusChip').style.opacity = hasArea ? .5 : 1;
    }

    function renderPlaceChip(){
      placeChip.innerHTML='';
      if(!chosenPlace) return;
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML=`<span>${chosenPlace.label}</span> <button title="Ukloni" aria-label="Ukloni">‚úï</button>`;
      chip.querySelector('button').addEventListener('click', ()=>{ chosenPlace=null; renderPlaceChip(); setLocks(); });
      placeChip.appendChild(chip);
    }

    function fillCountries(){
      selCountry.innerHTML=Object.keys(COUNTRY_FILES).map(c=>`<option>${c}</option>`).join('');
      selCountry.dispatchEvent(new Event('change'));
    }
    selCountry.addEventListener('change', async ()=>{
      selCity.innerHTML='<option>Uƒçitavam‚Ä¶</option>'; selCity.disabled=true;
      try{
        const url=COUNTRY_FILES[selCountry.value];
        const list=await (await fetch(url,{cache:'no-cache'})).json();
        list.sort((a,b)=> a.name.localeCompare(b.name,'hr'));
        selCity.innerHTML=list.map(ci=>`<option data-lat="${ci.lat}" data-lng="${ci.lng}">${ci.name}</option>`).join('');
        selCity.disabled=false;
      }catch{ selCity.innerHTML='<option>Gre≈°ka pri uƒçitavanju</option>'; selCity.disabled=false; }
    });

    btnPickPlace.addEventListener('click', ()=>{
      if (btnPickPlace.disabled){ toast('Najprije oƒçisti radijus.'); return; }
      tempPlace = chosenPlace ? {...chosenPlace} : null; // snapshot
      fillCountries();
      if (tempPlace){
        selCountry.value = tempPlace.country;
        selCountry.dispatchEvent(new Event('change'));
        setTimeout(()=>{ selCity.value = tempPlace.city; },80);
      }
      dlgPlace.showModal();
    });
    function closePlace(){ tempPlace=null; dlgPlace.close(); }
    $('#placeCancel').addEventListener('click', closePlace);
    $('#placeX').addEventListener('click', closePlace);
    dlgPlace.addEventListener('cancel', (e)=>{ e.preventDefault(); closePlace(); });

    $('#placeSave').addEventListener('click', ()=>{
      const opt=selCity.selectedOptions[0]; if(!opt){ toast('Odaberi grad.'); return; }
      const lat=parseFloat(opt.dataset.lat), lng=parseFloat(opt.dataset.lng);
      const label = selCountry.value+' / '+selCity.value;
      chosenPlace = { country:selCountry.value, city:selCity.value, lat, lng, label };
      chosenRadius = null; renderRadiusChip();  // mutual exclusive
      renderPlaceChip(); setLocks();
      closePlace();
    });

    /* ===== RADIJUS (svijetli, Save/Cancel/‚úï) ===== */
    const dlgRadius=$('#dlgRadius'), radiusList=$('#radiusList'), radiusChip=$('#radiusChip');
    function renderRadiusList(){
      radiusList.innerHTML='';
      for(let km=10; km<=100; km+=10){
        const btn=document.createElement('button');
        btn.type='button'; btn.className='radius-btn';
        btn.textContent = km+' km';
        if (tempRadius===km) btn.setAttribute('aria-current','true');
        btn.addEventListener('click', ()=>{
          tempRadius = km;
          [...radiusList.children].forEach(b=>b.removeAttribute('aria-current'));
          btn.setAttribute('aria-current','true');
        });
        radiusList.appendChild(btn);
      }
    }
    function renderRadiusChip(){
      radiusChip.innerHTML='';
      if(chosenRadius==null) return;
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML=`<span>${chosenRadius} km</span> <button title="Ukloni" aria-label="Ukloni">‚úï</button>`;
      chip.querySelector('button').addEventListener('click', ()=>{ chosenRadius=null; renderRadiusChip(); setLocks(); });
      radiusChip.appendChild(chip);
    }
    $('#btnPickRadius').addEventListener('click', ()=>{
      if ($('#btnPickRadius').disabled){ toast('Najprije oƒçisti podruƒçje.'); return; }
      tempRadius = Number.isFinite(chosenRadius) ? chosenRadius : null;
      renderRadiusList();
      dlgRadius.showModal();
    });
    function closeRadius(){ tempRadius=null; dlgRadius.close(); }
    $('#radiusCancel').addEventListener('click', closeRadius);
    $('#radiusX').addEventListener('click', closeRadius);
    dlgRadius.addEventListener('cancel', (e)=>{ e.preventDefault(); closeRadius(); });
    $('#radiusSave').addEventListener('click', ()=>{
      if(!Number.isFinite(tempRadius)){ toast('Odaberi radijus.'); return; }
      chosenRadius = tempRadius;
      chosenPlace = null; renderPlaceChip();   // mutual exclusive
      renderRadiusChip(); setLocks();
      closeRadius();
    });

    /* ===== PRETRAGA ===== */
    const btnSearch = $('#btnSearch');
    const results = $('#results');
    let fullList=[];

    btnSearch.addEventListener('click', async ()=>{
      if (!selectedSkills.size){
        toast('Odaberi barem jednu vje≈°tinu.'); return;
      }
      if (!chosenPlace && !Number.isFinite(chosenRadius)){
        toast('Odaberi podruƒçje ili radijus.'); return;
      }

      // Ako backend podr≈æava vi≈°e vje≈°tina: ≈°aljemo "skills"
      const filters = { skills: Array.from(selectedSkills) };
      // Ako podr≈æava samo jednu, mo≈æe≈° promijeniti u: filters.skill = Array.from(selectedSkills)[0];

      if (chosenPlace){
        filters.location = chosenPlace.label;
        filters.qlat = chosenPlace.lat;
        filters.qlng = chosenPlace.lng;
      } else if (Number.isFinite(chosenRadius)){
        filters.radius_km = chosenRadius;
        // Ako backend treba qlat/qlng za radijus, uzmi ih iz korisniƒçke spremljene lokacije (profil / Tra≈æim uslugu).
      }

      try{
        results.innerHTML = '';
        fullList = await apiProviders(filters);
        if(!fullList.length){
          results.innerHTML = '<div class="card card-pad">Nema rezultata za zadane filtere.</div>';
          return;
        }
        // default sort: po udaljenosti
        fullList.sort((a,b)=>(a.distance_km??9999)-(b.distance_km??9999));
        fullList.forEach(p=>{
          const el=document.createElement('div');
          el.className='card card-pad';
          const skillsStr = (p.skills||[]).slice(0,3).join(', ') || '‚Äî';
          const badge = (p.reviews_enabled? `<span class="badge">‚≠ê Recenzije ukljuƒçene</span>` : '');
          const dist = (p.distance_km!=null) ? ` ¬∑ üìè ${p.distance_km} km` : '';
          el.innerHTML = `
            <div class="prov-head">
              <div>
                <div style="font-weight:800;font-size:18px;display:inline-block;margin-right:8px">${p.name || 'Majstor'}</div>
                ${badge}
                <div class="muted">üß© ${skillsStr}</div>
                <div class="muted">üìç ${p.location || '-'}${dist}</div>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <a class="btn btn-ghost btn-small" href="provider.html?id=${p.id}">Pregled profila</a>
                <a class="btn btn-primary btn-small" href="provider.html?id=${p.id}#kontakt">Po≈°alji upit</a>
              </div>
            </div>`;
          results.appendChild(el);
        });
      }catch(e){
        results.innerHTML = '<div class="card card-pad">Gre≈°ka pri pretra≈æivanju.</div>';
      }
    });

    // init
    renderSkillChips(); renderPlaceChip(); renderRadiusChip(); setLocks();
  </script>
</body>
</html>
