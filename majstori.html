<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pronaƒëi majstora ‚Äî Dogovoreno.com</title>
  <link rel="stylesheet" href="base.css">
  <style>
    :root{
      --bg:#0f1115; --ink:#0b1220; --muted:#c7cbd4;
      --cta:#2563eb; --accent:#16a34a;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.35);
      --fieldBorder:rgba(255,255,255,.12);
    }
    body{ background:#0f1115; color:#f7f8fa; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif }
    .page{ min-height:100svh; display:grid; grid-template-rows:auto 1fr auto; }
    .page-wrap{ max-width:980px; margin:18px auto 64px; padding:0 16px; }

    /* PANEL (isti kao na nudim/tra≈æim) ‚Äì antracit wrapper */
    .panel{
      background: linear-gradient(180deg, rgba(26,29,35,.96) 0%, rgba(22,25,31,.96) 100%);
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }

    /* Cloud (svijetle kartice) ‚Äì identiƒçno */
    .cloud{
      background: linear-gradient(180deg, rgba(255,255,255,.78) 0%, rgba(246,247,249,.72) 100%);
      backdrop-filter: blur(4px);
      border:1px solid rgba(0,0,0,.06);
      border-radius:var(--radius);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 8px 22px rgba(0,0,0,.22);
      padding:16px; margin:12px 0; color:var(--ink);
    }
    .cloud h3{ margin:0 0 10px; font-size:18px; color:#0b1220 }
    .lead{ color:#c7cbd4 }
    .hint{ color:#334155; font-size:12px; margin-top:6px }
    .row{ display:grid; gap:10px }
    .row.two{ grid-template-columns:1fr 1fr }

    .chips{ display:flex; flex-wrap:wrap; gap:8px }
    .chip{
      display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
      border:1px solid rgba(0,0,0,.10); background:rgba(255,255,255,.6); font-weight:600; color:#0b1220;
    }
    .chip button{ all:unset; cursor:pointer; opacity:.85 } .chip button:hover{ opacity:1 }

    .btn{ appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer }
    .btn-primary{
      background:linear-gradient(180deg, #2b6ee9 0%, #245ed0 100%);
      color:#fff; border:1px solid rgba(0,0,0,.2);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 6px 16px rgba(37,99,235,.28);
      transition: transform .08s ease;
    }
    .btn-primary:active{ transform: translateY(1px); }
    .btn-ghost{ background:transparent; color:#ffffff; border:2px solid #ffffff; }
    .btn-small{ padding:8px 10px; border-radius:10px }

    /* Inputs kao i drugdje (u cloud) */
    .cloud select, .cloud input[type="text"]{
      width:100%; padding:12px; border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
      background:#ffffff; color:#0b1220;
      outline:none; font-family:inherit;
    }
    .cloud select:focus, .cloud input:focus{
      outline:2px solid rgba(37,99,235,.25);
      border-color:rgba(37,99,235,.45);
    }

    /* Rezultati (karte) ‚Äì vizual neutralan */
    .card{ border:1px solid var(--fieldBorder); border-radius:12px; background:rgba(255,255,255,.06); }
    .card-pad{ padding:16px }
    .results{ display:grid; gap:12px }
    @media(min-width:720px){ .results{ grid-template-columns:1fr 1fr } }
    .prov-head{ display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap }
    .muted{ color:#c7cbd4 }
    .badge{ display:inline-flex; align-items:center; gap:6px; border:1px solid var(--fieldBorder); border-radius:999px; padding:4px 8px; font-size:12px; background:rgba(255,255,255,.06) }

    /* Toast ‚Äì naranƒçasti */
    .toast{
      position:fixed; left:50%; bottom:25px; transform:translateX(-50%);
      background:#f97316; color:#fff; padding:10px 14px; border-radius:12px; box-shadow:var(--shadow);
      display:none; z-index:9999;
    }
    .toast.show{ display:block }

    /* Dialogi ‚Äì identiƒçni */
    dialog{ border:0; border-radius:16px; background:#0e1014; color:#f7f8fa; width:min(720px, 96vw) }
    dialog::backdrop{ background:rgba(0,0,0,.4) }
    .dlg-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08) }
    .dlg-body{ padding:0; max-height:70vh; overflow:auto; overscroll-behavior:contain }
    .dlg-actions{ padding:14px 16px; display:flex; gap:10px; justify-content:center; border-top:1px solid rgba(255,255,255,.08) }
    .dlg-search{ position:sticky; top:0; z-index:2; background:#0e1014; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08) }

    /* Skill list u popupu */
    #skillSearch{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#0b0d11; color:#fff }
    .list{ display:grid; gap:8px; padding:14px 16px; min-height:35vh }
    .item{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03) }
    .item input{ transform:scale(1.2) }

    /* DlgPlace ‚Äì SVIJETLI kao drugdje */
    #dlgPlace{
      background: linear-gradient(180deg, rgba(255,255,255,.90) 0%, rgba(246,247,249,.86) 100%);
      color:#0b1220;
    }
    #dlgPlace .dlg-head{ border-bottom:1px solid rgba(0,0,0,.08) }
    #dlgPlace .dlg-actions{ border-top:1px solid rgba(0,0,0,.08) }
    #dlgPlace .field select, #dlgPlace .field input{
      background:#ffffff; color:#0b1220; border:1px solid rgba(0,0,0,.15);
      border-radius:12px; padding:10px 12px; outline:none; font-family:inherit; font-size:inherit;
    }
    #dlgPlace .field select:focus, #dlgPlace .field input:focus{
      outline:2px solid rgba(37,99,235,.25); border-color:rgba(37,99,235,.45);
    }

    /* DlgRadius ‚Äì tamni kao skills */
    #dlgRadius .dlg-body{ padding:14px 16px }
    .radius-grid{ display:grid; gap:8px; grid-template-columns:repeat(3,1fr) }
    .radius-btn{
      appearance:none; border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:10px 12px;
      background:rgba(255,255,255,.06); color:#f7f8fa; cursor:pointer; text-align:center;
    }
    .radius-btn[aria-current="true"]{ outline:2px solid #16a34a; outline-offset:0 }
  </style>
</head>
<body>
  <main class="page">
    <div data-include="header.html"></div>

    <div class="page-wrap">
      <div class="panel">
        <h1 style="font-weight:600; font-size:clamp(18px,3vw,26px); margin:0 0 6px">Pronaƒëi majstora</h1>
        <div class="lead" style="margin-bottom:10px">Odaberi vje≈°tinu i podruƒçje ili radijus. Pretraga se pokreƒáe automatski. Sortiranje po potrebi.</div>

        <!-- 1) VJE≈†TINA -->
        <section class="cloud" aria-labelledby="lab-skill">
          <h3 id="lab-skill">Vje≈°tina</h3>
          <div class="row">
            <div id="skillChip" class="chips" aria-live="polite"></div>
            <div><button id="btnPickSkill" class="btn btn-primary btn-small" type="button">Odaberi vje≈°tinu</button></div>
          </div>
          <div class="hint">* Mo≈æe se odabrati jedna vje≈°tina. Isti popup kao drugdje.</div>
        </section>

        <!-- 2) PODRUƒåJE ILI RADIJUS (meƒëusobno iskljuƒçivo) -->
        <section class="cloud" aria-labelledby="lab-where">
          <h3 id="lab-where">Podruƒçje ili radijus</h3>

          <div class="row two">
            <div>
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                <button id="btnPickPlace" class="btn btn-ghost btn-small" type="button">Odaberi podruƒçje</button>
                <div id="placeChip" class="chips" aria-live="polite"></div>
              </div>
              <div class="hint">* Popup je isti kao ‚ÄúPodruƒçje djelovanja‚Äù (dr≈æava ‚Üí grad).</div>
            </div>

            <div>
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                <button id="btnPickRadius" class="btn btn-ghost btn-small" type="button">Odaberi radijus</button>
                <div id="radiusChip" class="chips" aria-live="polite"></div>
              </div>
              <div class="hint">* Radijus: 10 km ‚Üí 100 km (po 10 km).</div>
            </div>
          </div>

          <div class="hint" style="margin-top:8px">* Mo≈æe biti odabrano samo <b>jedno</b>: ili podruƒçje <i>ili</i> radijus.</div>
        </section>

        <!-- 3) SORTIRAJ (plavi gumb) -->
        <div style="display:flex; justify-content:flex-end; margin-top:12px">
          <button id="btnSort" class="btn btn-primary">Sortiraj</button>
        </div>

        <!-- REZULTATI -->
        <section id="resultsWrap" style="margin-top:12px">
          <div id="emptyHint" class="card card-pad">Odaberi vje≈°tinu i podruƒçje ili radijus, pa priƒçekaj rezultate.</div>
          <section id="results" class="results"></section>
        </section>
      </div>
    </div>

    <div data-include="footer.html"></div>
  </main>

  <!-- ====== DIALOGI ====== -->
  <!-- Skills (isti vizual kao drugdje, 1 komad) -->
  <dialog id="dlgSkills">
    <div class="dlg-head">
      <strong>Odaberi vje≈°tinu (1)</strong>
      <button class="btn btn-ghost btn-small" type="button" onclick="dlgSkills.close()">‚úï</button>
    </div>
    <div class="dlg-body">
      <div class="dlg-search"><input id="skillSearch" placeholder="Pretra≈æi ruƒçno.."></div>
      <div id="skillList" class="list" role="listbox" aria-multiselectable="false"></div>
    </div>
    <div class="dlg-actions">
      <button class="btn btn-ghost" type="button" onclick="dlgSkills.close()">Zatvori</button>
    </div>
  </dialog>

  <!-- Podruƒçje (svijetli kao drugdje) -->
  <dialog id="dlgPlace">
    <div class="dlg-head">
      <strong>Ruƒçni odabir mjesta</strong>
      <button class="btn btn-ghost btn-small" id="btnPlaceX" type="button">‚úï</button>
    </div>
    <div class="dlg-body" style="padding:14px 16px">
      <div class="row two">
        <div class="field"><label class="help">Dr≈æava</label><select id="selCountry"></select></div>
        <div class="field"><label class="help">Grad / Mjesto</label><select id="selCity"></select></div>
      </div>
      <div class="hint" style="margin-top:8px">Sustav koristi centroid grada za izraƒçun udaljenosti.</div>
    </div>
    <div class="dlg-actions">
      <button class="btn btn-ghost" id="btnPlaceCancel" type="button">Odustani</button>
      <button class="btn btn-primary" id="placeSave" type="button">Spremi</button>
    </div>
  </dialog>

  <!-- Radijus (10‚Üí100 km) -->
  <dialog id="dlgRadius">
    <div class="dlg-head">
      <strong>Odaberi radijus</strong>
      <button class="btn btn-ghost btn-small" type="button" onclick="dlgRadius.close()">‚úï</button>
    </div>
    <div class="dlg-body">
      <div class="radius-grid" id="radiusList"></div>
    </div>
    <div class="dlg-actions">
      <button class="btn btn-ghost" type="button" onclick="dlgRadius.close()">Zatvori</button>
    </div>
  </dialog>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="include.js"></script>
  <script>
    /* ===== UTIL ===== */
    const $ = s => document.querySelector(s);
    const toast = (m)=>{ const t=$('#toast'); t.textContent=m; t.classList.add('show'); clearTimeout(t._hide); t._hide=setTimeout(()=>t.classList.remove('show'),3000); };

    /* ===== API (isti endpointi) ===== */
    async function apiProviders(filters={}){
      const qs = new URLSearchParams();
      if (filters.skill) qs.set('skill', filters.skill);
      if (filters.location) qs.set('location', filters.location);
      if (Number.isFinite(filters.qlat)) qs.set('qlat', filters.qlat);
      if (Number.isFinite(filters.qlng)) qs.set('qlng', filters.qlng);
      if (Number.isFinite(filters.radius_km)) qs.set('radius_km', filters.radius_km);
      const r = await fetch('api/auth.php?route=providers&'+qs.toString());
      const j = await r.json();
      if(!r.ok) throw new Error(j.error||'Gre≈°ka');
      return j.data || [];
    }
    async function apiProviderDetail(id){
      const r = await fetch('api/auth.php?route=provider&id='+encodeURIComponent(id));
      const j = await r.json();
      if(!r.ok) throw new Error(j.error||'Gre≈°ka');
      return j.data;
    }

    /* ===== SKILLS (1 komad) ===== */
    const ALL_SKILLS=[];
    const dlgSkills = $('#dlgSkills');
    const skillSearch = $('#skillSearch');
    const skillList = $('#skillList');
    const skillChip = $('#skillChip');
    let selectedSkill = '';

    function renderSkillChip(){
      skillChip.innerHTML='';
      if(!selectedSkill) return;
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML=`<span>${selectedSkill}</span> <button title="Ukloni" aria-label="Ukloni">‚úï</button>`;
      chip.querySelector('button').addEventListener('click', ()=>{ selectedSkill=''; renderSkillChip(); autoSearch(); });
      skillChip.appendChild(chip);
    }
    function renderSkillList(filter=''){
      skillList.innerHTML='';
      const f=(filter||'').toLowerCase().trim();
      ALL_SKILLS
        .filter(s=>!f || s.toLowerCase().includes(f))
        .forEach(s=>{
          const row=document.createElement('label'); row.className='item';
          row.innerHTML=`<span>${s}</span><input type="radio" name="skillPick">`;
          row.querySelector('input').addEventListener('change', ()=>{ selectedSkill=s; renderSkillChip(); dlgSkills.close(); autoSearch(); });
          skillList.appendChild(row);
        });
    }
    $('#btnPickSkill').addEventListener('click', ()=>{
      dlgSkills.showModal();
      skillSearch.value='';
      renderSkillList();
      setTimeout(()=>skillSearch.focus(),50);
    });
    skillSearch.addEventListener('input', ()=> renderSkillList(skillSearch.value));
    fetch('data/skills.json').then(r=>r.json()).then(list=>{
      const arr = Array.isArray(list) ? list : (Array.isArray(list.skills) ? list.skills : []);
      ALL_SKILLS.push(...arr.sort((a,b)=>a.localeCompare(b,'hr')));
      renderSkillList();
    }).catch(()=>{});

    /* ===== PODRUƒåJE (dr≈æava/grad) ===== */
    const dlgPlace=$('#dlgPlace'), selCountry=$('#selCountry'), selCity=$('#selCity');
    const placeChip=$('#placeChip');
    const COUNTRY_FILES={
      "BiH": "data/cities-bih.json",
      "Hrvatska": "data/cities-hr.json",
      "Srbija": "data/cities-rs.json",
      "Slovenija": "data/cities-si.json",
      "Crna Gora": "data/cities-me.json",
      "S. Makedonija": "data/cities-mk.json"
    };

    let chosenPlace = null;   // { country, city, lat, lng, label }
    let chosenRadius = null;  // number (km)

    function fillCountries(){ selCountry.innerHTML=Object.keys(COUNTRY_FILES).map(c=>`<option>${c}</option>`).join(''); selCountry.dispatchEvent(new Event('change')); }
    selCountry.addEventListener('change', async ()=>{
      selCity.innerHTML='<option>Uƒçitavam‚Ä¶</option>';
      try{
        const url=COUNTRY_FILES[selCountry.value];
        const list=await (await fetch(url,{cache:'no-cache'})).json();
        list.sort((a,b)=> a.name.localeCompare(b.name,'hr'));
        selCity.innerHTML=list.map(ci=>`<option data-lat="${ci.lat}" data-lng="${ci.lng}">${ci.name}</option>`).join('');
      }catch{ selCity.innerHTML='<option>Gre≈°ka pri uƒçitavanju</option>'; }
    });

    function renderPlaceChip(){
      placeChip.innerHTML='';
      if(!chosenPlace) return;
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML=`<span>${chosenPlace.label}</span> <button title="Ukloni" aria-label="Ukloni">‚úï</button>`;
      chip.querySelector('button').addEventListener('click', ()=>{ chosenPlace=null; renderPlaceChip(); enableRadius(); autoSearch(); });
      placeChip.appendChild(chip);
    }

    function disableRadius(){
      $('#btnPickRadius').disabled = true;
      $('#radiusChip').style.opacity = .5;
      if (chosenRadius!=null) { /* veƒá je izabran, ali onemoguƒáavamo interakciju dok se ne oƒçisti podruƒçje */ }
    }
    function enableRadius(){
      $('#btnPickRadius').disabled = false;
      $('#radiusChip').style.opacity = 1;
      chosenRadius=null; renderRadiusChip();
    }
    function disablePlace(){
      $('#btnPickPlace').disabled = true;
      $('#placeChip').style.opacity = .5;
    }
    function enablePlace(){
      $('#btnPickPlace').disabled = false;
      $('#placeChip').style.opacity = 1;
      chosenPlace=null; renderPlaceChip();
    }

    $('#btnPickPlace').addEventListener('click', ()=>{
      if (chosenRadius!=null){ toast('Prvo uklonite radijus da biste birali podruƒçje.'); return; }
      fillCountries();
      dlgPlace.showModal();
    });
    $('#btnPlaceX').addEventListener('click', (e)=>{ e.preventDefault(); dlgPlace.close(); });
    $('#btnPlaceCancel').addEventListener('click', (e)=>{ e.preventDefault(); dlgPlace.close(); });
    $('#placeSave').addEventListener('click', ()=>{
      const opt=selCity.selectedOptions[0]; if(!opt){ toast('Odaberite grad.'); return; }
      const lat=parseFloat(opt.dataset.lat), lng=parseFloat(opt.dataset.lng);
      const label = selCountry.value+' / '+selCity.value;
      chosenPlace = { country:selCountry.value, city:selCity.value, lat, lng, label };
      renderPlaceChip();
      disableRadius();
      dlgPlace.close();
      autoSearch();
    });

    /* ===== RADIJUS (10‚Üí100 km) ===== */
    const dlgRadius=$('#dlgRadius'), radiusList=$('#radiusList'), radiusChip=$('#radiusChip');
    function renderRadiusList(){
      radiusList.innerHTML='';
      for(let km=10; km<=100; km+=10){
        const btn=document.createElement('button');
        btn.type='button'; btn.className='radius-btn';
        btn.textContent = km+' km';
        if (chosenRadius===km) btn.setAttribute('aria-current','true');
        btn.addEventListener('click', ()=>{
          chosenRadius = km;
          renderRadiusChip();
          disablePlace();
          dlgRadius.close();
          autoSearch();
        });
        radiusList.appendChild(btn);
      }
    }
    function renderRadiusChip(){
      radiusChip.innerHTML='';
      if(chosenRadius==null) return;
      const chip=document.createElement('span'); chip.className='chip';
      chip.innerHTML=`<span>${chosenRadius} km</span> <button title="Ukloni" aria-label="Ukloni">‚úï</button>`;
      chip.querySelector('button').addEventListener('click', ()=>{ chosenRadius=null; renderRadiusChip(); enablePlace(); autoSearch(); });
      radiusChip.appendChild(chip);
    }
    $('#btnPickRadius').addEventListener('click', ()=>{
      if (chosenPlace){ toast('Prvo uklonite podruƒçje da biste birali radijus.'); return; }
      renderRadiusList();
      dlgRadius.showModal();
    });

    /* ===== SORT ===== */
    const btnSort = $('#btnSort');
    let sortMode = 'dist'; // 'dist' | 'name' | 'updated'
    // mali dijalog za sort (inline, bez posebnog HTML-a)
    btnSort.addEventListener('click', ()=>{
      const dlg=document.createElement('dialog');
      dlg.innerHTML = `
        <div class="dlg-head"><strong>Sortiranje</strong><button class="btn btn-ghost btn-small" type="button">‚úï</button></div>
        <div class="dlg-body" style="padding:14px 16px">
          <label class="item"><span>Udaljenost (najbli≈æe)</span><input type="radio" name="sm" value="dist" ${sortMode==='dist'?'checked':''}></label>
          <label class="item"><span>Ime (A‚Äì≈Ω)</span><input type="radio" name="sm" value="name" ${sortMode==='name'?'checked':''}></label>
          <label class="item"><span>A≈æurirano (novo ‚Üí staro)</span><input type="radio" name="sm" value="updated" ${sortMode==='updated'?'checked':''}></label>
        </div>
        <div class="dlg-actions">
          <button class="btn btn-ghost" type="button">Zatvori</button>
          <button class="btn btn-primary" type="button" id="okSort">Primijeni</button>
        </div>`;
      document.body.appendChild(dlg);
      const closeBtns = dlg.querySelectorAll('.btn-ghost'); closeBtns.forEach(b=> b.addEventListener('click', ()=> dlg.close()));
      dlg.addEventListener('close', ()=> dlg.remove());
      dlg.showModal();
      dlg.querySelector('#okSort').addEventListener('click', ()=>{
        const val = dlg.querySelector('input[name="sm"]:checked')?.value || 'dist';
        sortMode = val;
        applySort(); renderResults();
        dlg.close();
      });
    });

    /* ===== REZULTATI ===== */
    const results = $('#results');
    const emptyHint = $('#emptyHint');
    let fullList=[]; let viewList=[];

    function applySort(){
      viewList = [...fullList];
      if (sortMode==='name'){
        viewList.sort((a,b)=>(a.name||'').localeCompare(b.name||'','hr'));
      } else if (sortMode==='updated'){
        viewList.sort((a,b)=> new Date(b.updated_at) - new Date(a.updated_at));
      } else {
        viewList.sort((a,b)=>(a.distance_km??9999) - (b.distance_km??9999));
      }
    }
    function renderResults(){
      results.innerHTML='';
      if (!viewList.length){
        emptyHint.style.display='block';
        return;
      }
      emptyHint.style.display='none';
      viewList.forEach(p=>{
        const el=document.createElement('div');
        el.className='card card-pad';
        const skills = (p.skills||[]).slice(0,3).join(', ') || '‚Äî';
        const badge = (p.reviews_enabled? `<span class="badge">‚≠ê Recenzije ukljuƒçene</span>` : '');
        const dist = (p.distance_km!=null) ? ` ¬∑ üìè ${p.distance_km} km` : '';
        el.innerHTML = `
          <div class="prov-head">
            <div>
              <div style="font-weight:800;font-size:18px;display:inline-block;margin-right:8px">${p.name || 'Majstor'}</div>
              ${badge}
              <div class="muted">üß© ${skills}</div>
              <div class="muted">üìç ${p.location || '-'}${dist}</div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <a class="btn btn-ghost btn-small" href="provider.html?id=${p.id}">Pregled profila</a>
              <a class="btn btn-primary btn-small" href="provider.html?id=${p.id}#kontakt">Po≈°alji upit</a>
            </div>
          </div>`;
        results.appendChild(el);
      });
    }

    async function autoSearch(){
      // preduvjet: barem vje≈°tina + (podruƒçje ili radijus) ‚Äì vje≈°tina mo≈æe i bez, ali bolje nuditi korisniku poruku
      if (!selectedSkill && !chosenPlace && chosenRadius==null){
        emptyHint.style.display='block'; results.innerHTML='';
        return;
      }

      const filters = {
        skill: selectedSkill || '',
      };

      if (chosenPlace){
        filters.location = chosenPlace.label;
        filters.qlat = chosenPlace.lat;
        filters.qlng = chosenPlace.lng;
        delete filters.radius_km;
      } else if (chosenRadius!=null){
        // za radijus bez qlat/q lng: korisnik nema svoje koordinate; ovdje bi inaƒçe trebalo qlat/qlng iz user-loka ili centra dr≈æave
        // fallback: samo radius_km bez lat/lng ‚Üí backend mo≈æe to ignorirati ili koristiti ranije poznatu lokaciju
        filters.radius_km = chosenRadius;
      }

      try{
        fullList = await apiProviders(filters);
        applySort();
        renderResults();
        if (!fullList.length){
          toast('Nema rezultata za zadane filtere.');
        }
      }catch(e){
        results.innerHTML = '<div class="card card-pad">Gre≈°ka pri pretra≈æivanju.</div>';
      }
    }

    // gumbi
    $('#btnPickPlace').addEventListener('click', ()=>{/* handled above */});
    $('#btnPickRadius').addEventListener('click', ()=>{/* handled above */});

    // inicijalno
    renderSkillChip(); renderPlaceChip(); renderRadiusChip();
  </script>
</body>
</html>
